<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js" async></script>
    <script src="./countries.js"></script>
    <script src="./geo-search-helper.umd.js"></script>
    <title>Testing getGeo</title>
  </head>

    <h1>Your position</h1>
    <div id="pos">[no position yet]</div>
    <div id="map" style="width: 100%; height: 500px"></div>

    <script>
      // Position options
      const getPositionOpt = {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }

      // Position promise
      function getPosition() {
        return new Promise((res, rej) => {
          navigator.geolocation.getCurrentPosition(res, rej, getPositionOpt)
        })
      }
      // Show
      function showMap(position, bounds) {
        const map = L.map('map',
          {
            center: [position.lat, position.lon]
          }
        )
        const boundsArr = [[bounds.sw.lat, bounds.sw.lon],[bounds.ne.lat, bounds.ne.lon]]
        console.log(boundsArr)
        map.fitBounds(boundsArr)
        const circle = L.circle([position.lat, position.lon], {
          color: 'rgba(0,0,0, .4)',
          fillColor: 'black',
          fillOpacity: 0.15,
          radius: 35000
      }).addTo(map);
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map)
      }

      // Tying all the position stuff together
      function getPositionCallback() {
        getPosition()
        // format position object
        .then((pos) => {
          const crd = pos.coords;
          const position = { lat: crd.latitude, lon: crd.longitude }          
          return position
        })
        // Do your stuff here
        .then((position) => {
          populateHTML(position)
          console.log(position)
          const posObj = gsh.mapBoundsPosKm(position, 35)
          console.log('SW, NE boundaries: ' + JSON.stringify(posObj))
          showMap(position, posObj)
        })
        // Handle errors
        .catch((err) => {
          console.log(err)
          const error = { errortype: err.code, errormessage: err.message }
          populateHTML(error)
          return error
        })
      }

      // Dummy HTML populate
      function populateHTML(msg) {
        const node = document.createElement('span').innerText = JSON.stringify(msg, 2, ' ')
        document.getElementById('pos').replaceChildren(node)
      }

      // Fire up the position magic
      getPositionCallback()
    </script>
  </body>
</html> 